<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ˜ì˜ì¥ Excel ê´€ë¦¬</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .description {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 6px;
            border-left: 4px solid #4CAF50;
        }
        .section h2 {
            margin-top: 0;
            color: #333;
            font-size: 1.3em;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        input[type="file"] {
            margin: 10px 0;
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            display: block;
        }
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            display: block;
        }
        .instructions {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        .instructions li {
            margin: 8px 0;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŠ ìˆ˜ì˜ì¥ Excel ê´€ë¦¬</h1>
        <p class="description">
            ìˆ˜ì˜ì¥ ì •ë³´ë¥¼ Excel íŒŒì¼(.xlsx)ë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³ , ìˆ˜ì • í›„ ì—…ë¡œë“œí•˜ì—¬ ëŒ€ëŸ‰ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            <br>í•œê¸€ì´ ì™„ë²½í•˜ê²Œ ì§€ì›ë©ë‹ˆë‹¤!
        </p>

        <!-- 1. Excel ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ -->
        <div class="section">
            <h2>1ï¸âƒ£ Excel ë‹¤ìš´ë¡œë“œ</h2>
            <div class="instructions">
                <p><strong>ì‚¬ìš© ë°©ë²•:</strong></p>
                <ol>
                    <li>ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í˜„ì¬ ëª¨ë“  ìˆ˜ì˜ì¥ ì •ë³´ë¥¼ Excel íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ</li>
                    <li>Excelì—ì„œ íŒŒì¼ ì—´ê¸° (í•œê¸€ ì™„ë²½ ì§€ì›)</li>
                    <li>ê°€ê²© ì •ë³´ ìˆ˜ì • (ë¹ˆ ì¹¸ì— ì‹¤ì œ ê°€ê²© ì…ë ¥)</li>
                    <li>Excel íŒŒì¼ë¡œ ì €ì¥ (.xlsx í˜•ì‹)</li>
                </ol>
            </div>
            <button onclick="downloadExcel()">ğŸ“¥ Excel ë‹¤ìš´ë¡œë“œ</button>
            <div id="downloadResult" class="result"></div>
        </div>

        <!-- 2. Excel ì—…ë¡œë“œ ì„¹ì…˜ -->
        <div class="section">
            <h2>2ï¸âƒ£ Excel ì—…ë¡œë“œ (ì¼ê´„ ì—…ë°ì´íŠ¸)</h2>
            <div class="instructions">
                <p><strong>ì—…ë°ì´íŠ¸ ê°€ëŠ¥í•œ í•­ëª©:</strong></p>
                <ul>
                    <li>âœ… <strong>ì£¼ì†Œ</strong> - ì˜ëª»ëœ ì£¼ì†Œ ìˆ˜ì • ê°€ëŠ¥</li>
                    <li>âœ… <strong>ì „í™”ë²ˆí˜¸</strong> - ì „í™”ë²ˆí˜¸ ìˆ˜ì • ê°€ëŠ¥</li>
                    <li>âœ… <strong>í•œë‹¬ ìˆ˜ê°•ê¶Œ</strong> - ìˆ«ìë§Œ ì…ë ¥ (ì› ë‹¨ìœ„ ì—†ì´)</li>
                    <li>âœ… <strong>ììœ ìˆ˜ì˜</strong> - ìˆ«ìë§Œ ì…ë ¥ (ì› ë‹¨ìœ„ ì—†ì´)</li>
                    <li>âœ… <strong>ì›¹ì‚¬ì´íŠ¸</strong> - URL ìˆ˜ì • ê°€ëŠ¥</li>
                </ul>
                <p><strong>ì£¼ì˜ì‚¬í•­:</strong></p>
                <ul>
                    <li><code>ID</code> ì»¬ëŸ¼ì€ ë°˜ë“œì‹œ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤ (ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€)</li>
                    <li>ë¹„ì–´ìˆëŠ” ì¹¸ì€ ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</li>
                    <li>.xlsx í˜•ì‹ìœ¼ë¡œ ì €ì¥í•˜ì„¸ìš”</li>
                </ul>
            </div>
            <input type="file" id="excelFile" accept=".xlsx" />
            <button onclick="uploadExcel()">ğŸ“¤ Excel ì—…ë¡œë“œ ë° ì—…ë°ì´íŠ¸</button>
            <div id="uploadResult" class="result"></div>
        </div>

        <!-- API ì—”ë“œí¬ì¸íŠ¸ ì •ë³´ -->
        <div class="section" style="border-left-color: #2196F3;">
            <h2>ğŸ“¡ API ì—”ë“œí¬ì¸íŠ¸</h2>
            <p><strong>ë‹¤ìš´ë¡œë“œ:</strong> <code>GET /api/excel/export</code></p>
            <p><strong>ì—…ë¡œë“œ:</strong> <code>POST /api/excel/import</code></p>
            <p style="margin-top: 15px; color: #666; font-size: 0.9em;">
                curl ëª…ë ¹ì–´ë¡œë„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤:
            </p>
            <pre style="background: #f4f4f4; padding: 10px; border-radius: 4px; overflow-x: auto;">
# ë‹¤ìš´ë¡œë“œ
curl http://localhost:8000/api/excel/export -o pools.xlsx

# ì—…ë¡œë“œ
curl -X POST http://localhost:8000/api/excel/import -F "file=@pools.xlsx"
            </pre>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        async function downloadExcel() {
            const resultDiv = document.getElementById('downloadResult');
            resultDiv.className = 'result';
            resultDiv.textContent = 'ë‹¤ìš´ë¡œë“œ ì¤‘...';
            resultDiv.style.display = 'block';

            try {
                const response = await fetch(`${API_BASE}/api/excel/export`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'swimming_pools.xlsx';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);

                resultDiv.className = 'result success';
                resultDiv.textContent = 'âœ… Excel íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ! (í•œê¸€ ì™„ë²½ ì§€ì›)';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        }

        async function uploadExcel() {
            const fileInput = document.getElementById('excelFile');
            const resultDiv = document.getElementById('uploadResult');

            if (!fileInput.files.length) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ Excel íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”';
                resultDiv.style.display = 'block';
                return;
            }

            const file = fileInput.files[0];

            if (!file.name.endsWith('.xlsx')) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ Excel íŒŒì¼(.xlsx)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤';
                resultDiv.style.display = 'block';
                return;
            }

            resultDiv.className = 'result';
            resultDiv.textContent = 'ì—…ë¡œë“œ ì¤‘...';
            resultDiv.style.display = 'block';

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch(`${API_BASE}/api/excel/import`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.detail || 'ì—…ë¡œë“œ ì‹¤íŒ¨');
                }

                let message = `âœ… ì—…ë°ì´íŠ¸ ì™„ë£Œ!\n\n`;
                message += `â€¢ ì „ì²´ í–‰: ${data.total_rows}ê°œ\n`;
                message += `â€¢ ì—…ë°ì´íŠ¸: ${data.updated_count}ê°œ\n`;

                if (data.errors && data.errors.length > 0) {
                    message += `\nâš ï¸ ì˜¤ë¥˜ ë°œìƒ (${data.errors.length}ê°œ):\n`;
                    data.errors.slice(0, 5).forEach(err => {
                        message += `  - ${err.row}ë²ˆ í–‰: ${err.error}\n`;
                    });
                    if (data.errors.length > 5) {
                        message += `  ... ì™¸ ${data.errors.length - 5}ê°œ\n`;
                    }
                }

                resultDiv.className = 'result success';
                resultDiv.innerHTML = message.replace(/\n/g, '<br>');
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        }
    </script>
</body>
</html>
